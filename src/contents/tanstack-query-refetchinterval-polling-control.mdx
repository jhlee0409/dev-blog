---
title: "ë‹¤ìš´ë¡œë“œ ìƒíƒœì— ë”°ë¥¸ í´ë§ ì œì–´: TanStack Query refetchInterval í•¨ìˆ˜í˜• íŒ¨í„´"
publishedAt: "2025-04-15"
summary: "TanStack Queryì˜ refetchInterval í•¨ìˆ˜í˜• íŒ¨í„´ì„ í™œìš©í•´ ë‹¤ìš´ë¡œë“œ ìƒíƒœì— ë”°ë¼ í´ë§ì„ ìë™ìœ¼ë¡œ ì¤‘ë‹¨í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤."
tags: "React, TanStack Query, ìµœì í™”, TypeScript"
---

í”„ë¡œì íŠ¸ì—ì„œ ë‹¤ìš´ë¡œë“œ ì‘ì—…ì˜ ìƒíƒœë¥¼ ê´€ë¦¬í•  ë•Œ, ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì¤„ì´ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ì. íŠ¹íˆ TanStack Queryì˜ `refetchInterval`ì„ ë™ì ìœ¼ë¡œ í™œìš©í•˜ì—¬ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ ë˜ëŠ” ì‹¤íŒ¨ ì‹œ í´ë§ì„ ìë™ìœ¼ë¡œ ì¤‘ë‹¨í•˜ëŠ” íŒ¨í„´ì„ ì‚´í´ë³¸ë‹¤.

## ğŸ” í•´ê²°í•˜ë ¤ëŠ” ë¬¸ì œ

í”„ë¡œì íŠ¸ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆë‹¤:

- ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ì•„ì´í…œì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŒ
- ë‹¤ìš´ë¡œë“œ ìš”ì²­ì€ ì „ì—­ ìƒíƒœì˜ stackì— ìŒ“ì„
- ê° ë‹¤ìš´ë¡œë“œ ì§„í–‰ ìƒí™©ì„ í† ìŠ¤íŠ¸ í˜•íƒœì˜ ë¦¬ìŠ¤íŠ¸ë¡œ í‘œì‹œ
- ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ê±°ë‚˜ ì‹¤íŒ¨í•˜ë©´ ë” ì´ìƒ ìƒíƒœ í™•ì¸ì´ ë¶ˆí•„ìš”

ì´ëŸ° ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ì²˜ìŒì—ëŠ” ë‹¨ìˆœíˆ ê³ ì • ê°„ê²©ìœ¼ë¡œ í´ë§í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í–ˆë‹¤:

```tsx
const query = useQueries({
  queries: taskIds.map((id) => ({
    queryKey: ["downloadTask", id],
    queryFn: () => fetchDownloadStatus(id),
    refetchInterval: 2500, // ëª¨ë“  ìƒíƒœì—ì„œ í•­ìƒ 2.5ì´ˆë§ˆë‹¤ refetch
  })),
});
```

ì´ ë°©ì‹ì˜ ë¬¸ì œëŠ” ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ê±°ë‚˜ ì‹¤íŒ¨í•´ë„ ê³„ì†í•´ì„œ APIë¥¼ í˜¸ì¶œí•œë‹¤ëŠ” ì ì´ë‹¤.

## ğŸ’¡ `refetchInterval` í•¨ìˆ˜í˜• ì‚¬ìš©ì˜ ë°œê²¬

TanStack Query ë¬¸ì„œì—ì„œ `refetchInterval`ì´ ë‹¨ìˆœ ìˆ«ìë¿ë§Œ ì•„ë‹ˆë¼ í•¨ìˆ˜ë„ ë°›ì„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ë°œê²¬í–ˆë‹¤:

```typescript
refetchInterval: number |
  false |
  ((query: Query) => number | false | undefined);
```

ì´ ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ ê° ì¿¼ë¦¬ì˜ ìƒíƒœì— ë”°ë¼ í´ë§ ë™ì‘ì„ ë™ì ìœ¼ë¡œ ì œì–´í•  ìˆ˜ ìˆë‹¤.

## ğŸ› ï¸ ê°œì„ ëœ êµ¬í˜„

ë‹¤ìŒì€ ë‹¤ìš´ë¡œë“œ ìƒíƒœì— ë”°ë¼ refetchë¥¼ ì¤‘ë‹¨í•˜ëŠ” ìµœì í™”ëœ ì½”ë“œì´ë‹¤:

```tsx
import { useQueries } from "@tanstack/react-query";

type DownloadStatus = "pending" | "processing" | "complete" | "error";

interface DownloadTask {
  id: string;
  fileName: string;
  progress: number;
  status: DownloadStatus;
  error?: string;
}

const fetchDownloadTask = async (taskId: string): Promise<DownloadTask> => {
  const response = await fetch(`/api/downloads/${taskId}`);
  if (!response.ok) {
    throw new Error("ë‹¤ìš´ë¡œë“œ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨");
  }
  return response.json();
};

export const useDownloadTasks = (
  taskIds: string[],
  options?: { enabled?: boolean }
) => {
  const { enabled = true } = options ?? {};

  return useQueries({
    queries: taskIds.map((taskId) => ({
      queryKey: ["downloadTask", taskId],
      queryFn: () => fetchDownloadTask(taskId),
      enabled,
      // ìƒíƒœì— ë”°ë¼ refetchInterval ë™ì  ì„¤ì •
      refetchInterval: (query) => {
        const data = query.state.data as DownloadTask | undefined;

        // ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ì§„í–‰ ì¤‘ì¸ ìƒíƒœì¼ ë•Œë§Œ refetch
        if (!data || (data.status !== "complete" && data.status !== "error")) {
          return 2500; // 2.5ì´ˆë§ˆë‹¤ refetch
        }

        return false; // ì™„ë£Œë˜ê±°ë‚˜ ì‹¤íŒ¨í•œ ê²½ìš° refetch ì¤‘ë‹¨
      },
    })),
  });
};
```

## ğŸ“‹ ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

ì´ í›…ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìš´ë¡œë“œ í† ìŠ¤íŠ¸ ëª©ë¡ì„ í‘œì‹œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤:

```tsx
import { useDownloadTasks } from "./useDownloadTasks";
import { useDownloadStore } from "./store";

const DownloadToastList = () => {
  // ì „ì—­ ìƒíƒœì—ì„œ ë‹¤ìš´ë¡œë“œ ì‘ì—… ID ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  const downloadTaskIds = useDownloadStore((state) => state.taskIds);

  // ë‹¤ìš´ë¡œë“œ ì‘ì—… ìƒíƒœ ì¡°íšŒ ë° ìë™ í´ë§
  const downloadTasksQueries = useDownloadTasks(downloadTaskIds);

  return (
    <div className="download-toast-container">
      {downloadTasksQueries.map((query, index) => {
        const task = query.data;
        if (!task) return null;

        return (
          <div key={downloadTaskIds[index]} className="download-toast">
            <h4>{task.fileName}</h4>

            {task.status === "pending" && <span>ëŒ€ê¸° ì¤‘...</span>}

            {task.status === "processing" && (
              <>
                <progress value={task.progress} max="100" />
                <span>{task.progress}%</span>
              </>
            )}

            {task.status === "complete" && <span>ì™„ë£Œë¨!</span>}

            {task.status === "error" && (
              <span className="error">ì˜¤ë¥˜: {task.error}</span>
            )}
          </div>
        );
      })}
    </div>
  );
};
```

## ğŸ”„ êµ¬í˜„ì˜ í•µì‹¬ í¬ì¸íŠ¸

ì´ íŒ¨í„´ì˜ í•µì‹¬ì€ `refetchInterval` í•¨ìˆ˜ì—ì„œ ì¿¼ë¦¬ ìƒíƒœë¥¼ ê²€ì‚¬í•˜ëŠ” ë¶€ë¶„ì´ë‹¤:

```typescript
refetchInterval: (query) => {
  const data = query.state.data as DownloadTask | undefined;

  if (!data || (data.status !== "complete" && data.status !== "error")) {
    return 2500; // ê³„ì† í´ë§
  }

  return false; // í´ë§ ì¤‘ë‹¨
};
```

ì´ í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë¡œì§ìœ¼ë¡œ ë™ì‘í•œë‹¤:

1. ì¿¼ë¦¬ ê°ì²´ì˜ í˜„ì¬ ìƒíƒœ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤
2. ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ì•„ì§ ì§„í–‰ ì¤‘ì¸ ìƒíƒœë©´ 2.5ì´ˆë§ˆë‹¤ refetch ê³„ì† ìˆ˜í–‰
3. ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ê±°ë‚˜ ì‹¤íŒ¨í•œ ê²½ìš° `false`ë¥¼ ë°˜í™˜í•˜ì—¬ í´ë§ ì¤‘ë‹¨

## âš™ï¸ ì‹¤ë¬´ í™œìš©ì„ ìœ„í•œ í™•ì¥ íŒ¨í„´

ì´ ê¸°ë³¸ íŒ¨í„´ì„ ë” ë°œì „ì‹œí‚¬ ìˆ˜ ìˆëŠ” ë°©ë²•ë“¤:

### 1. ìƒíƒœë³„ ë‹¤ë¥¸ í´ë§ ê°„ê²© ì ìš©

```typescript
refetchInterval: (query) => {
  const data = query.state.data;
  if (!data) return 3000; // ì´ˆê¸° ìƒíƒœëŠ” 3ì´ˆ

  switch (data.status) {
    case "pending":
      return 5000; // ëŒ€ê¸° ì¤‘ì¼ ë•ŒëŠ” 5ì´ˆ
    case "processing":
      return 1000; // ì§„í–‰ ì¤‘ì¼ ë•ŒëŠ” 1ì´ˆ
    default:
      return false; // ì™„ë£Œ ë˜ëŠ” ì‹¤íŒ¨ ì‹œ ì¤‘ë‹¨
  }
};
```

### 2. ì§„í–‰ë¥ ì— ë”°ë¥¸ í´ë§ ê°„ê²© ìµœì í™”

```typescript
refetchInterval: (query) => {
  const data = query.state.data;
  if (!data || data.status !== "processing") return 3000;

  // ì§„í–‰ë¥ ì´ ë†’ì„ìˆ˜ë¡ ë” ìì£¼ í´ë§
  return data.progress > 80 ? 500 : data.progress > 50 ? 1000 : 2000;
};
```

### 3. ì—ëŸ¬ ìƒíƒœì— ë”°ë¥¸ ì¬ì‹œë„ ë¡œì§ ì¶”ê°€

```typescript
refetchInterval: (query) => {
  // ì—ëŸ¬ ë°œìƒ ì‹œ ì ì‹œ í›„ ì¬ì‹œë„ ë¡œì§
  if (query.state.error) {
    return query.state.fetchFailureCount < 3 ? 5000 : false;
  }

  const data = query.state.data;
  if (!data || data.status === "processing") return 2000;
  return false;
};
```

## ğŸ“š ì¶”ê°€ ê³ ë ¤ì‚¬í•­

- **ë©”ëª¨ë¦¬ ê´€ë¦¬**: ì™„ë£Œëœ ì‘ì—…ì€ ì¼ì • ì‹œê°„ í›„ ì „ì—­ ìƒíƒœì—ì„œ ì œê±°í•˜ëŠ” ë¡œì§ ì¶”ê°€
- **ì¼ê´„ ì·¨ì†Œ**: ì—¬ëŸ¬ ë‹¤ìš´ë¡œë“œë¥¼ í•œë²ˆì— ì·¨ì†Œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ êµ¬í˜„
- **ì˜¤ë¥˜ ì¬ì‹œë„**: ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì— ëŒ€í•œ ìë™ ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ ì¶”ê°€
- **ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬**: ë¸Œë¼ìš°ì € íƒ­ì´ ë¹„í™œì„±í™”ë  ë•Œ í´ë§ ê°„ê²© ì¡°ì •

## ğŸ§  ë§ˆì¹˜ë©°

TanStack Queryì˜ `refetchInterval`ì„ í•¨ìˆ˜ë¡œ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´ì€ ì‹¤ì‹œê°„ ìƒíƒœ ê´€ë¦¬ê°€ í•„ìš”í•œ ë‹¤ì–‘í•œ ìƒí™©ì—ì„œ ìœ ìš©í•˜ë‹¤. ì´ëŸ° ì„¸ë°€í•œ ìµœì í™”ëŠ” ì‚¬ìš©ì ê²½í—˜ í–¥ìƒê³¼ ì„œë²„ ë¦¬ì†ŒìŠ¤ ì ˆì•½ ë‘ ê°€ì§€ ëª¨ë‘ë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

ë‹¤ìš´ë¡œë“œ ìƒíƒœ ê´€ë¦¬, ì‹¤ì‹œê°„ ì•Œë¦¼, ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ë“± ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì´ íŒ¨í„´ì„ ì‘ìš©í•´ë³¼ ìˆ˜ ìˆë‹¤. TanStack Query ë¬¸ì„œë¥¼ í†µí•´ ë” ë§ì€ ê³ ê¸‰ ê¸°ëŠ¥ë“¤ì„ í™•ì¸í•´ë³´ëŠ” ê²ƒë„ ì¶”ì²œí•œë‹¤.
